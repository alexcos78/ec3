---
- hosts: localhost
  connection: local
  tasks:
    - block:
      - name: Download dns_registry.py
        get_url:
          url: https://raw.githubusercontent.com/grycap/ec3/tosca/tosca/artifacts/dns_registry.py
          dest: /opt/dns_registry.py
          mode: 0755

      - name: Install PIP
        package: name=python3-pip

      - name: Install boto3
        pip: name=boto3

      - name: Register DNS record
        command: python /opt/dns_registry.py create {{ dns_service }} "{{ dns_service_credentials["token"] }}" {{ record_name }} {{ domain_name }} {{ ip_address }}
        args:
          creates: /opt/dns_registry.out

      when: record_name != ""
